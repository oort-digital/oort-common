{"version":3,"file":"index.es.js","sources":["../src/serializers.ts","../src/searchParams.ts"],"sourcesContent":["import { NumOrUndef, NumRange } from \"./typesAndInterfaces\"\r\n\r\nexport interface ISerializer<T> {\r\n    key: string\r\n    serialize: (paramVal: T) => string[]\r\n    deserialize: (paramStr: string[]) => T\r\n}\r\n\r\nexport class StringSerializer implements ISerializer<string> {\r\n\r\n    readonly key: string\r\n    serialize = (paramVal: string) => [paramVal]\r\n    deserialize = (params: string[]) => params[0]\r\n\r\n    constructor(key: string) {\r\n        this.key = key\r\n    }\r\n}\r\n\r\nexport class BoolSerializer implements ISerializer<boolean> {\r\n\r\n    readonly key: string\r\n    serialize = (paramVal: boolean) => [`${paramVal}`]\r\n    deserialize = (params: string[]) => params[0] === 'true'\r\n\r\n    constructor(key: string) {\r\n        this.key = key\r\n    }\r\n}\r\n\r\nexport class IntSerializer implements ISerializer<number> {\r\n\r\n    readonly key: string\r\n    serialize = (paramVal: number) => [paramVal.toString()]\r\n    deserialize = (params: string[]) => parseInt(params[0])\r\n\r\n    constructor(key: string) {\r\n        this.key = key\r\n    }\r\n}\r\n\r\nexport class NumRangeSerializer implements ISerializer<NumRange> {\r\n\r\n    private static sep = '-'\r\n\r\n    readonly key: string\r\n\r\n    serialize = (paramVal: NumRange) => {\r\n        let result = ''\r\n        if(NumRangeSerializer.isDefined(paramVal[0])) {\r\n            result = paramVal[0]!.toString()\r\n        }\r\n        \r\n        if(NumRangeSerializer.isDefined(paramVal[1])) {\r\n            result = `${result}${NumRangeSerializer.sep}${paramVal[1]!.toString()}`\r\n        }\r\n        return [result]\r\n    }\r\n\r\n    deserialize = (params: string[]): NumRange => {\r\n        const arr = params[0].split(NumRangeSerializer.sep)\r\n        if(arr.length === 1) {\r\n            return [NumRangeSerializer.deserializeItem(arr[0]), undefined]\r\n        }\r\n        return [NumRangeSerializer.deserializeItem(arr[0]), NumRangeSerializer.deserializeItem(arr[1])]\r\n    }\r\n    \r\n    constructor(key: string) {\r\n        this.key = key\r\n    }\r\n\r\n    private static deserializeItem(str: string | undefined): NumOrUndef {\r\n        if(str) {\r\n            return parseFloat(str)\r\n        }\r\n        return undefined\r\n    }\r\n\r\n    private static isDefined(val: NumOrUndef): boolean {\r\n        //null value happens too\r\n        return val !== undefined && val !== null\r\n    }\r\n}\r\n\r\nexport class ArraySerializer<T> implements ISerializer<T[]> {\r\n\r\n    readonly key: string\r\n\r\n    constructor(key: string, parseFunc: (str: string) => T) {\r\n        this.key = key\r\n        this._parseFunc = parseFunc\r\n    }\r\n\r\n    serialize(arr: T[]): string[] {\r\n        const p =  arr.join(this._sep)\r\n        return [p]\r\n    }\r\n\r\n    deserialize(params: string[]): T[] {\r\n        return params[0].split(this._sep).map(x => this._parseFunc(x))\r\n    }\r\n\r\n    private readonly _sep = '-'\r\n    private readonly _parseFunc: (str: string) => T\r\n}","import { ArraySerializer, BoolSerializer, IntSerializer, ISerializer, NumRangeSerializer } from \"./serializers\";\r\nimport { NumRange, URLSearchParamsSetter } from \"./typesAndInterfaces\";\r\n\r\nexport abstract class BaseSearchParam<T> {\r\n\r\n    get param() { return this._param }\r\n\r\n    get isEmpty() { return this.isParamEmpty(this._param) }\r\n\r\n    protected isParamEmpty(paramVal: T) {\r\n        if(Array.isArray(paramVal)) {\r\n            return paramVal.length === 0\r\n        }\r\n        return !paramVal\r\n    }\r\n\r\n    clear() {\r\n        this._param = this._def\r\n        this._searchParams.delete(this._serializer.key)\r\n        this._setter(this._searchParams)\r\n    }\r\n\r\n    setParam(paramVal: T) {\r\n        this._param = paramVal\r\n        this._searchParams.delete(this._serializer.key)\r\n\r\n        if(!this.isParamEmpty(paramVal)) {\r\n            const params = this._serializer.serialize(paramVal)\r\n            params.forEach(p => this._searchParams.append(this._serializer.key, p))\r\n        }\r\n\r\n        this._setter(this._searchParams)\r\n    }\r\n    \r\n    constructor(searchParams: URLSearchParams, setter: URLSearchParamsSetter, serializer: ISerializer<T>, def: T) {\r\n        this._searchParams = searchParams\r\n        this._setter = setter\r\n        this._serializer = serializer\r\n        const params = searchParams.getAll(serializer.key)\r\n        this._def = def\r\n        this._param = params.length ? serializer.deserialize(params) : def\r\n    }\r\n\r\n    private readonly _def\r\n    private readonly _searchParams: URLSearchParams\r\n    private readonly _setter: URLSearchParamsSetter\r\n    private readonly _serializer: ISerializer<T>\r\n    private _param: T\r\n}\r\n\r\nconst isNumRangeNotEmpty = (range: NumRange) => range[0] !== undefined || range[1] !== undefined\r\n\r\nexport class NumRangeSearchParam extends BaseSearchParam<NumRange> {\r\n    protected isParamEmpty = (paramVal: NumRange) => !isNumRangeNotEmpty(paramVal)\r\n\r\n    constructor(key: string, searchParams: URLSearchParams, setter: URLSearchParamsSetter) {\r\n        super(searchParams, setter, new NumRangeSerializer(key), [undefined, undefined])\r\n    }\r\n}\r\n\r\nexport class IntArrSearchParam extends BaseSearchParam<number[]> {\r\n    constructor(key: string, searchParams: URLSearchParams, setter: URLSearchParamsSetter) {\r\n        super(searchParams, setter, new ArraySerializer<number>(key, parseInt), [])\r\n    }\r\n}\r\n\r\nexport class StrArrSearchParam extends BaseSearchParam<string[]> {\r\n    constructor(key: string, searchParams: URLSearchParams, setter: URLSearchParamsSetter) {\r\n        super(searchParams, setter, new ArraySerializer<string>(key, x => x), [])\r\n    }\r\n}\r\n\r\nexport class IntSearchParam extends BaseSearchParam<number> {\r\n    constructor(key: string, defaultValue: number, searchParams: URLSearchParams, setter: URLSearchParamsSetter) {\r\n        super(searchParams, setter, new IntSerializer(key), defaultValue)\r\n    }\r\n}\r\n\r\nexport class BoolSearchParam extends BaseSearchParam<boolean> {\r\n    constructor(key: string, defaultValue: boolean, searchParams: URLSearchParams, setter: URLSearchParamsSetter) {\r\n        super(searchParams, setter, new BoolSerializer(key), defaultValue)\r\n    }\r\n}"],"names":["key","paramVal","params","_NumRangeSerializer","result","arr","str","val","parseFunc","x","p","searchParams","setter","serializer","def","isNumRangeNotEmpty","range","NumRangeSerializer","ArraySerializer","defaultValue","IntSerializer","BoolSerializer"],"mappings":"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"}