{"version":3,"file":"index.es.js","sources":["../src/connectorProvider.ts","../src/baseConnector.ts","../src/connectorNames.ts","../src/injectedConnector.ts","../src/walletConnectConnector.ts"],"sourcesContent":["import { ILogger } from \"@oort/logger\";\nimport { ConnectorNames } from \"./connectorNames\";\nimport { IConnector } from \"./iConnector\";\n\nconst lsKey = 'cur_connector';\n\nconst getCurConnectorName = () : ConnectorNames | undefined => {\n    const curCnnNameStr = localStorage.getItem(lsKey);\n    return curCnnNameStr ? curCnnNameStr as ConnectorNames : undefined;\n}\n\nconst setCurConnectorName = (connectorName: ConnectorNames) => localStorage.setItem(lsKey, connectorName);\nconst removeCurConnectorName = () => localStorage.removeItem(lsKey);\n\n\nexport class ConnectorProvider\n{\n    private readonly _logger: ILogger\n    public readonly connectorsByName: { [name: string]: IConnector } = {}\n    private _curConnector: IConnector | undefined\n    public readonly WaitInitialisationAsync : Promise<void>\n\n    private async InitAsync(connectors: IConnector[], curConnectorName?: ConnectorNames): Promise<void> {\n        let curConnector: IConnector | undefined = undefined\n        for(let i = 0; i < connectors.length; i++) {\n            const c = connectors[i]\n            this.connectorsByName[c.name] = c\n            if(c.name === curConnectorName) {\n                if(await c.isConnected) {\n                    curConnector = c\n                }\n            }\n        }\n\n        if(curConnector) {\n            if(await curConnector.enable()) {\n                this._curConnector = curConnector\n                this._logger.debug(`Current connector is ${this._curConnector.name}`)\n            }\n        }\n    }\n\n    constructor(logger: ILogger, connectors: IConnector[]) {\n        this._logger = logger\n        this.WaitInitialisationAsync = this.InitAsync(connectors, getCurConnectorName());\n    }\n\n    public get CurConnector(): IConnector | undefined {\n        return this._curConnector;\n    }\n\n    async EnableAsync(connectorName: ConnectorNames): Promise<any> {\n        await this.WaitInitialisationAsync\n        const curConnector = this.connectorsByName[connectorName]\n        if(await curConnector.enable()) {\n            setCurConnectorName(connectorName)\n            this._curConnector = curConnector\n        }\n    }\n\n    async disconnect(): Promise<void> {\n        await this._curConnector?.disconnect()\n        removeCurConnectorName()\n        this._curConnector = undefined\n    }\n}","import { providers, Signer } from \"ethers\";\nimport { ILogger } from \"@oort/logger\";\nimport { ConnectorNames } from \"./connectorNames\";\n\ntype AccountChangedHandlerType = (accounts: Array<string>) => void\ntype ChainChangedHandlerType = (chainId: string) => void\ntype DisconnectHandlerType = (error: any) => void\n\nexport interface IChainInfo {\n    name: string\n    chainId: number\n    rpcUrl: string\n    blockExplorer: string\n    nativeCurrency?: {\n        name: string\n        symbol: string\n        decimals: number\n    }\n}\nexport interface IChainMap {\n    [chainId: number]: IChainInfo\n  }\n\nexport abstract class BaseConnector {\n    name: ConnectorNames;\n\n    protected readonly _chains: IChainMap = {}\n\n    private _externalAccountChangedHandlers: AccountChangedHandlerType[] = []\n    private accountsChangedHandler?: AccountChangedHandlerType\n\n    private _externalChainChangedHandlers: ChainChangedHandlerType[] = []\n    private chainChangedHandler?: ChainChangedHandlerType\n\n    private _externalDisconnectHandlers: DisconnectHandlerType[] = []\n    protected disconnectHandler?: DisconnectHandlerType\n\n    protected readonly logger: ILogger\n\n    private readonly _checkConnectionDelayMs : number = 500;\n    private _timerId?: NodeJS.Timeout;\n    \n    private async CheckConnection(): Promise<void> {\n        if(!await this.isConnected)\n        {\n            if(this._timerId) {\n                clearInterval(this._timerId)\n                this.logger.debug(`${this.name}Connector. CheckConnection stopped`)\n            }\n\n            this._externalDisconnectHandlers.forEach(h => h(undefined));\n            this._externalDisconnectHandlers = [];\n        }\n    }\n\n    constructor(logger: ILogger, name: ConnectorNames, chains: IChainInfo[]) {\n        this.name = name\n        this.logger = logger\n        chains.forEach(x => this._chains[x.chainId] = x)\n    }\n\n    protected initListeners(rawProvider: any) {\n\n        this.logger.debug('initListeners')\n        const that = this\n        this.accountsChangedHandler = (accounts: Array<string>) => {\n            this.logger.debug(`${this.name}.accountsChangedHandler`)\n            that._externalAccountChangedHandlers.forEach(h => h(accounts));\n        }\n\n        this.chainChangedHandler = (chainId: string) => {\n            this.logger.debug(`${this.name}.chainChangedHandler`)\n            that._externalChainChangedHandlers.forEach(h => h(chainId));\n        }\n\n        this.disconnectHandler = (error: any) => {\n            this.logger.debug(`${this.name}.disconnectHandler ${JSON.stringify(error)}`)\n            that._externalDisconnectHandlers.forEach(h => h(error));\n        }\n\n        rawProvider.on('accountsChanged', this.accountsChangedHandler);\n        rawProvider.on('chainChanged', this.chainChangedHandler);\n        // use custom connection check by timer. See onDisconnect\n        // rawProvider.on(\"disconnect\", this.disconnectHandler);\n    }\n\n    private removeListeners() {\n        this.rawProvider.removeListener('accountsChanged', this.accountsChangedHandler);\n        this.rawProvider.removeListener('chainChanged', this.chainChangedHandler);\n        // this.rawProvider.removeListener(\"disconnect\", this.disconnectHandler);\n        this._externalAccountChangedHandlers = []\n        this._externalChainChangedHandlers = []\n        this._externalDisconnectHandlers = []\n    }\n\n    protected abstract get rawProvider(): any;\n   \n    onAccountsChanged(handler: AccountChangedHandlerType) {\n        this._externalAccountChangedHandlers.push(handler)\n    }\n\n    onChainChanged(handler: ChainChangedHandlerType): void {\n        this._externalChainChangedHandlers.push(handler)\n    }\n\n    onDisconnect(handler: (error: any) => void): void {\n\n        if(!this._timerId) {\n            const self = this;\n            this._timerId = setInterval(() => self.CheckConnection(), this._checkConnectionDelayMs)\n        }\n        \n        this._externalDisconnectHandlers.push(handler);\n    }\n\n    abstract get isConnected(): Promise<boolean>\n\n    get signer(): Signer {\n        const provider = new providers.Web3Provider(this.rawProvider);\n        return provider.getSigner()\n    }\n\n    disconnect(): Promise<void> {\n        this.removeListeners()\n        return Promise.resolve()\n    }\n\n}","export enum ConnectorNames {\n    Undefined = '',\n    Injected = 'Injected',\n    WalletConnect = 'WalletConnect',\n}","import { ILogger } from \"@oort/logger\";\nimport { BaseConnector, IChainInfo } from \"./baseConnector\";\nimport { ConnectorNames } from \"./connectorNames\";\nimport { IConnector } from \"./iConnector\";\n\ndeclare global {\n    interface Window {\n        ethereum: any;\n    }\n}\n\nexport class InjectedConnector\n    extends BaseConnector\n    implements IConnector\n{\n  private _ethRequestAccounts: Promise<boolean> | undefined = undefined\n\n    constructor(logger: ILogger, chains: IChainInfo[]) {\n        super(logger, ConnectorNames.Injected, chains);\n        if(this.isInstalled) {\n          this.initListeners(window.ethereum)\n        }\n    }\n\n    get canSwitchChain() { return !!window.ethereum.isMetaMask }\n\n    async switchChain(chainId: number): Promise<void> {\n        const chainIdHex = `0x${chainId.toString(16)}`\n        try {\n\n            if(!this._chains[chainId]) {\n                throw new Error(`Chain ${chainId} not supported`)\n            }\n            await window.ethereum.request({\n              method: 'wallet_switchEthereumChain',\n              params: [{ chainId: chainIdHex }],\n            });\n          } catch (switchError: any) {\n            // This error code indicates that the chain has not been added to MetaMask.\n            if (switchError.code === 4902) {\n              try {\n                const chain = this._chains[chainId]\n                await window.ethereum.request({\n                  method: 'wallet_addEthereumChain',\n                  params: [{\n                    chainId: chainIdHex,\n                    chainName: chain.name,\n                    rpcUrls: [chain.rpcUrl],\n                    nativeCurrency: chain.nativeCurrency,\n                    blockExplorerUrls: [chain.blockExplorer]  }],\n                });\n              } catch (addError) {\n                throw addError\n              }\n            }\n            // handle other \"switch\" errors\n          }\n    }\n\n    private async prvEnable(): Promise<boolean> {\n      try {\n        await this.rawProvider.request({ method: 'eth_requestAccounts' })\n      }\n      catch(error: any) {\n        if (error.code === 4001) {\n          // EIP-1193 userRejectedRequest error\n          this.logger.warn('Please connect to MetaMask.');\n        } else {\n          this.logger.error(error);\n        }\n        return false\n      }\n      return true\n    }\n\n    async enable(): Promise<boolean> {\n        if(this._ethRequestAccounts) {\n          this.logger.debug('InjectedConnector.enable already called')\n          return await this._ethRequestAccounts\n        }\n\n        this.logger.debug('InjectedConnector.enable')\n        this._ethRequestAccounts = this.prvEnable()\n        const result = await this._ethRequestAccounts\n        this._ethRequestAccounts = undefined\n        return result;\n    }\n\n    private async isConnectedAsync(): Promise<boolean> {\n      const response: string[] = await window.ethereum.request({ method: 'eth_accounts' })\n      return response.length > 0\n    }\n\n    get isConnected(): Promise<boolean> {\n      return this.isConnectedAsync()\n    }\n\n    get isInstalled(): boolean {\n      return !!window.ethereum\n    }\n\n    get installUrl(): string {\n      return 'https://metamask.io/download'\n    }\n\n    protected get rawProvider(): any {\n        return window.ethereum\n    }\n}\n","import WalletConnectProvider from \"@walletconnect/web3-provider\";\nimport { IRPCMap } from \"@walletconnect/types\";\nimport { ILogger } from \"@oort/logger\";\nimport { BaseConnector, IChainInfo } from \"./baseConnector\";\nimport { ConnectorNames } from \"./connectorNames\";\nimport { IConnector } from \"./iConnector\";\n\nexport class WalletConnectConnector extends BaseConnector implements IConnector {\n\n    private _walletConnect: WalletConnectProvider\n    private readonly _rpc: IRPCMap\n\n    constructor(logger: ILogger, chains: IChainInfo[]) {\n        super(logger, ConnectorNames.WalletConnect, chains)\n        this._rpc = {}\n        chains.forEach(x => this._rpc[x.chainId] = x.rpcUrl)\n        this._walletConnect = new WalletConnectProvider({ rpc: this._rpc })\n        this.initListeners(this._walletConnect)\n    }\n\n    async disconnect(): Promise<void> {\n        await super.disconnect()\n        await this._walletConnect.disconnect()\n    }\n    \n    get canSwitchChain() { return false }\n\n    // @ts-ignore\n    switchChain(chainId: number): Promise<void> {\n        throw new Error(\"Method not implemented.\");\n    }\n\n    protected get rawProvider(): any {\n        return this._walletConnect;\n    }\n\n    get isConnected(): Promise<boolean> {\n        const lsItem = localStorage.getItem('walletconnect');\n        const result = (!!lsItem) && this._walletConnect.isWalletConnect\n        return Promise.resolve(result)\n        //return this._walletConnect.connected\n    }\n\n    get isInstalled(): boolean {\n        return true\n    }\n\n    get installUrl(): string {\n        return ''\n    }\n\n    async enable(): Promise<any> {\n        try {\n            return await this._walletConnect.enable();\n        }\n        catch(error)\n        {\n            this._walletConnect = new WalletConnectProvider({ rpc: this._rpc });\n            return Promise.reject<any>(error);\n        }\n    }\n}"],"names":["lsKey","getCurConnectorName","curCnnNameStr","setCurConnectorName","connectorName","removeCurConnectorName","logger","connectors","curConnectorName","curConnector","i","c","_a","name","chains","x","h","rawProvider","that","accounts","chainId","error","handler","self","providers","ConnectorNames","BaseConnector","chainIdHex","switchError","chain","addError","result","WalletConnectProvider"],"mappings":"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"}